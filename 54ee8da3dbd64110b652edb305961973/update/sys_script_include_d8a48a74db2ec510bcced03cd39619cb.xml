<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_snc_airline.HtmlRenderMissionSheetA4</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description>Renders the flight mission sheet as html fitting a DIN A4 page.</description>
        <name>HtmlRenderMissionSheetA4</name>
        <script><![CDATA[function HtmlRenderMissionSheetA4(grFlight)
{
	var GetStringValue = x_snc_devtools.GetStringValue;
	var IsValidRecord = x_snc_devtools.IsValidRecord;
	var GetRecord = x_snc_devtools.GetRecord;
	var GetIntegerValue = x_snc_devtools.GetIntegerValue;


	function RenderTime(strDateTime)
	{
		return x_snc_devtools.RenderTime(strDateTime).substr(0,5);
	}
	
	function RenderWeight(nWeight)
	{
		nWeight = GetIntegerValue(nWeight);
		if (nWeight == 0)
		{
			return '<span style="color: red;">unspecified</span>';
		}
		return nWeight + ' kg';
	}
	
	var strHtml = '';
	
	if (IsValidRecord(grFlight) == false)
	{
		strHtml += '<p style="text-color: red;">ERROR!</p>';
		strHtml = HtmlRenderPageA4(strHtml);
		return strHtml;
	}

	var aLAGs = GetLAGsFromFlight(grFlight.sys_id);
	var aParcels = GetParcelsFromLAGs(aLAGs);
	

	strHtml += '<style>';
	strHtml += 'th { background-color: lightgrey; text-align: left; padding: 5px; vertical-align: top; }';
	strHtml += 'td { text-align: left; padding: 5px; vertical-align: top;  }';
	strHtml += '</style>';
	
	strHtml += '<table style="width: 100%;"><tbody>';
	
		// MISSION SHEET TITLE
		strHtml += '<tr>';
			strHtml += '<th style="font-size: 200%; text-align: center;">';
			if (grFlight.state == 'planning')
			{
				strHtml += '<span style="color: red;">DRAFT</span> ';
			}
			strHtml += 'Mission Sheet '+grFlight.number;
			strHtml += '</th>';
		strHtml += '</tr>';


		// FLIGHT INFORMATION
		strHtml += '<tr>';
			strHtml += '<th style="font-size: 120%; text-align: center;">';
			strHtml += 'Flight Details';
			strHtml += '</th>';
		strHtml += '</tr>';
	
	strHtml += '</tbody></table>';
	
	strHtml += '<table style="width: 100%;"><tbody>';	
	
	strHtml += '<tr>';

		// AIRCRAFT AND PILOT
		strHtml += '<td>';
			strHtml += '<table width="100%"><tbody>';
			strHtml += '<tr><th>Tail number</th><td>'+grFlight.aircraft.tail_number+'</td></tr>';
			strHtml += '<tr><th>Aircraft model</th><td> '+grFlight.aircraft.model.name+'</td></tr>';
			strHtml += '<tr><th>Pilot</th><td>'+grFlight.pilot.name+'</td></tr>';
			strHtml += '</tbody></table>';
		strHtml += '<td>';

		// ROUTE
		strHtml += '<td>';
			strHtml += '<table width="100%"><tbody>';
				strHtml += '<tr><th colspan="4">Route (Zulu/UTC)</th></tr>';
				for (var nLAG = 0; nLAG < aLAGs.length; nLAG++)
				{
					var lag = aLAGs[nLAG];
					strHtml += '<tr>';
					strHtml += '<td>' + RenderTime(lag.departure_datetime) + '</td>';
					strHtml += '<td>' + lag.departure_icao + '</td>';
					strHtml += '<td>' + lag.arrival_icao + '</td>';
					strHtml += '<td>' + RenderTime(lag.arrival_datetime) + '</td>';
					strHtml += '</tr>';;
				}
			strHtml += '</tbody></table>';
		strHtml += '</td>';

	strHtml += '</tr>';
	strHtml += '</tbody></table>';
	
	

	strHtml += '<table style="width: 100%;"><tbody>';
		// CARGO TITLE
		strHtml += '<tr><th style="font-size: 120%; text-align: center;" colspan="5">Cargo Details</th></tr>';
		// CARGO OVERVIEW
		strHtml += '<tr>';
			strHtml += '<th>Categories</th><td>TODO</td>';
			strHtml += '<th>Total Weight</th><td>TODO</td>';
		strHtml += '</tr>';
	strHtml += '</tbody></table>';

	strHtml += '<table style="width: 100%;"><tbody>';
	
	strHtml += '<tr>';
		strHtml += '<th>Number</th><th>Category</th><th>Weight</th><th colspan="2">Departure</th><th colspan="2">Arrival</th>';
	strHtml += '</tr>';
	
	for (var nParcel = 0; nParcel < aParcels.length; nParcel++)
	{
		strHtml += '<tr>';
		
		var parcel = aParcels[nParcel]; 
		strHtml += '<td>'+parcel.number+'</td>';
		strHtml += '<td>'+parcel.categories+'</td>';
		strHtml += '<td style="text-align: right;">'+RenderWeight(parcel.total_weight)+'</td>';
		strHtml += '<td>'+RenderTime(parcel.departure_datetime)+'</td>';
		strHtml += '<td>'+parcel.departure_icao+'</td>';
		strHtml += '<td>'+parcel.arrival_icao+'</td>';
		strHtml += '<td>'+RenderTime(parcel.arrival_datetime)+'</td>';
		
		strHtml += '</tr>';
	}
	
	
	
	strHtml += '</tbody><table>';

	
	//strHtml += x_snc_devtools.HtmlRenderValue(aLAGs);
	//gs.addInfoMessage(x_snc_devtools.HtmlEncode(x_snc_devtools.RenderValue(aLAGs)));

	/*
	// TEXT
	var strText = GetStringValue(grParcel.text);
	if (strText != '')
	{
		strHtml += '<div style="font-size: 100%; line-height: 120%;">';
		strHtml += StringReplace(strText,'\n','<br/>')+' ';
		strHtml += '</div>';
	}
	*/


	


	strHtml += '</tbody></table>';


	strHtml = x_snc_devtools.HtmlRenderPageA4(strHtml,1,1);
	
	return strHtml;

}]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2022-03-27 19:55:46</sys_created_on>
        <sys_id>d8a48a74db2ec510bcced03cd39619cb</sys_id>
        <sys_mod_count>53</sys_mod_count>
        <sys_name>HtmlRenderMissionSheetA4</sys_name>
        <sys_package display_value="Airline WORK IN PROGRESS" source="x_snc_airline">54ee8da3dbd64110b652edb305961973</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="Airline WORK IN PROGRESS">54ee8da3dbd64110b652edb305961973</sys_scope>
        <sys_update_name>sys_script_include_d8a48a74db2ec510bcced03cd39619cb</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2022-03-31 17:59:55</sys_updated_on>
    </sys_script_include>
</record_update>
