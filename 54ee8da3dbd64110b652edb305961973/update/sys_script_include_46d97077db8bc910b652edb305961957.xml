<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_snc_airline.HtmlRenderPagePriorPermissionRequired</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <name>HtmlRenderPagePriorPermissionRequired</name>
        <script><![CDATA[function HtmlRenderPagePriorPermissionRequired()
{
	if (IsActive() == false)
	{
		return '';
	}
	

	var GetStringValue = x_snc_devtools.GetStringValue;
	var IsValidSysId = x_snc_devtools.IsValidSysId;
	var IsValidRecord = x_snc_devtools.IsValidRecord;
	var GetRecord = x_snc_devtools.GetRecord;
	var GetBoolValue = x_snc_devtools.GetBoolValue;
	var RenderDate = x_snc_devtools.RenderDate;
	

	
	function HtmlRenderPagePriorPermissionRequiredStateNoContext()
	{
		var strHtml = '';
 		strHtml += '<p style="color: red;">ERROR: No context defined!</p>';
		return strHtml;
	}
	
	function MakePriorPermissionRequiredHeader(grStop)
	{
		var strHeader = '';
		strHeader += GetStringValue(grStop.flight.number)
		strHeader += ' - Stop '+grStop.stop;
		strHeader += ' - '+grStop.airdrome.display;
		strHeader += ' - '+grStop.flight.aircraft.tail_number;
		return strHeader;
	}

	function MakePriorPermissionRequiredSubject(grStop)
	{
		var strSubject = '';
		strSubject += GetStringValue(grStop.flight.number)
		strSubject += ' - Stop '+grStop.stop;
		strSubject += ' - '+grStop.flight.aircraft.tail_number;
		strSubject += ' - '+RenderDate(grStop.arrival_datetime);
		return strSubject;
	}
	
	
	function HtmlRenderPagePriorPermissionRequiredStateStop(grStop)
	{
		strHtml = '';
		strHtml += '<h2>'+MakePriorPermissionRequiredHeader(grStop)+'</h2>';
		strHtml += '<span>Email:</span><pre>'+GetStringValue(grStop.airdrome.email)+'</pre>';
		strHtml += '<span>Subject:</span><pre>Prior Permission Required: '+MakePriorPermissionRequiredSubject(grStop)+'</pre>';
		strHtml += '<span>Body:</span><pre>'+MakePriorPermissionRequired(grStop)+'</pre>';
		return strHtml;
	}

	function HtmlRenderPagePriorPermissionRequiredStateFlight(grFlight)
	{
		var strHtml = ''; 
		var grStops = new GlideRecord('x_snc_airline_flight_stop');
		grStops.addQuery('flight','=',grFlight.sys_id);
		grStops.orderBy('stop');
		grStops.query();
		while(grStops.next())
		{
			strHtml += HtmlRenderPagePriorPermissionRequiredStateStop(grStops);
		}
		return strHtml;
	}	
	
	var strHtml = '';
	
	
	var strState = '';
	var strStop = GetStringValue(RP.getParameterValue('stop'));
	var strFlight = GetStringValue(RP.getParameterValue('flight'));
	var strMission = GetStringValue(RP.getParameterValue('mission'));

	
	var grFlight = GetFlightRecord(strFlight);
	if (IsValidRecord(grFlight) == true)
	{
		strState = 'flight';
	}
	else
	{
		var grStop = GetRecord('x_snc_airline_flight_stop',strStop);
		if (IsValidRecord(grStop) == true)
		{
			strState = 'stop';
		}
	}
	

	strHtml += '<h1>Prior Permission Required</h1>\n';

	switch (strState)
	{
	case 'stop':
		strHtml += HtmlRenderPagePriorPermissionRequiredStateStop(grStop);
		break;
	case 'flight':
		strHtml += HtmlRenderPagePriorPermissionRequiredStateFlight(grFlight);
		break;
	case 'mission':
		strHtml += HtmlRenderPagePriorPermissionRequiredStateMission(grMission);
		break;
	case '':
	default:
		strHtml += HtmlRenderPagePriorPermissionRequiredStateNoContext();
	}
	
	return strHtml;
}]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2022-04-30 18:47:08</sys_created_on>
        <sys_id>46d97077db8bc910b652edb305961957</sys_id>
        <sys_mod_count>21</sys_mod_count>
        <sys_name>HtmlRenderPagePriorPermissionRequired</sys_name>
        <sys_package display_value="Airline WORK IN PROGRESS" source="x_snc_airline">54ee8da3dbd64110b652edb305961973</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="Airline WORK IN PROGRESS">54ee8da3dbd64110b652edb305961973</sys_scope>
        <sys_update_name>sys_script_include_46d97077db8bc910b652edb305961957</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2022-04-30 20:31:46</sys_updated_on>
    </sys_script_include>
</record_update>
