<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_snc_airline.HtmlRenderPagePriorPermissionRequest</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <name>HtmlRenderPagePriorPermissionRequest</name>
        <script><![CDATA[function HtmlRenderPagePriorPermissionRequest()
{
	if (IsActive() == false)
	{
		return '';
	}
	

	var GetStringValue = x_snc_devtools.GetStringValue;
	var IsValidSysId = x_snc_devtools.IsValidSysId;
	var IsValidRecord = x_snc_devtools.IsValidRecord;
	var GetRecord = x_snc_devtools.GetRecord;
	var GetBoolValue = x_snc_devtools.GetBoolValue;
	var RenderDate = x_snc_devtools.RenderDate;
	

	
	function HtmlRenderPagePriorPermissionRequestStateNoContext()
	{
		var strHtml = '';
 		strHtml += '<p style="color: red;">ERROR: No context defined!</p>';
		return strHtml;
	}
	
	function MakePriorPermissionRequestHeader(grStop)
	{
		var strHeader = '';
		strHeader += GetStringValue(grStop.flight.number)
		strHeader += ' - Stop '+grStop.stop;
		strHeader += ' - '+grStop.airdrome.display;
		strHeader += ' - '+grStop.flight.aircraft.tail_number;
		return strHeader;
	}

	function MakePriorPermissionRequestSubject(grStop)
	{
		var strSubject = '';
		strSubject += GetStringValue(grStop.flight.number)
		strSubject += ' - Stop '+grStop.stop;
		strSubject += ' - '+grStop.flight.aircraft.tail_number;
		strSubject += ' - '+RenderDate(grStop.arrival_datetime);
		return strSubject;
	}
	
	
	function HtmlRenderPagePriorPermissionRequestStateStop(grStop)
	{
		strHtml = '';
		strHtml += '<h2>'+MakePriorPermissionRequestHeader(grStop)+'</h2>';
		strHtml += '<span>Email:</span><pre>'+GetStringValue(grStop.airdrome.email)+'</pre>';
		strHtml += '<span>Subject:</span><pre>Prior Permission Request: '+MakePriorPermissionRequestSubject(grStop)+'</pre>';
		strHtml += '<span>Body:</span><pre>'+MakePriorPermissionRequest(grStop)+'</pre>';
		return strHtml;
	}

	function HtmlRenderPagePriorPermissionRequestStateFlight(grFlight)
	{
		var strHtml = ''; 
		var grStops = new GlideRecord('x_snc_airline_flight_stop');
		grStops.addQuery('flight','=',grFlight.sys_id);
		grStops.orderBy('stop');
		grStops.query();
		while(grStops.next())
		{
			strHtml += HtmlRenderPagePriorPermissionRequestStateStop(grStops);
		}
		return strHtml;
	}	
	
	var strHtml = '';
	
	
	var strState = '';
	var strStop = GetStringValue(RP.getParameterValue('stop'));
	var strFlight = GetStringValue(RP.getParameterValue('flight'));
	var strMission = GetStringValue(RP.getParameterValue('mission'));

	
	var grFlight = GetFlightRecord(strFlight);
	if (IsValidRecord(grFlight) == true)
	{
		strState = 'flight';
	}
	else
	{
		var grStop = GetRecord('x_snc_airline_flight_stop',strStop);
		if (IsValidRecord(grStop) == true)
		{
			strState = 'stop';
		}
	}
	
		
	switch (strState)
	{
	case 'stop':
		strHtml += '<h1>Prior Permission Request</h1>\n';
		strHtml += HtmlRenderPagePriorPermissionRequestStateStop(grStop);
		break;
	case 'flight':
		strHtml += '<h1>Prior Permission Requests</h1>\n';
		strHtml += HtmlRenderPagePriorPermissionRequestStateFlight(grFlight);
		break;
	case 'mission':
		strHtml += HtmlRenderPagePriorPermissionRequestStateMission(grMission);
		break;
	case '':
	default:
		strHtml += HtmlRenderPagePriorPermissionRequestStateNoContext();
	}
	
	return strHtml;
}]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2022-04-30 18:47:08</sys_created_on>
        <sys_id>46d97077db8bc910b652edb305961957</sys_id>
        <sys_mod_count>19</sys_mod_count>
        <sys_name>HtmlRenderPagePriorPermissionRequest</sys_name>
        <sys_package display_value="Airline WORK IN PROGRESS" source="x_snc_airline">54ee8da3dbd64110b652edb305961973</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="Airline WORK IN PROGRESS">54ee8da3dbd64110b652edb305961973</sys_scope>
        <sys_update_name>sys_script_include_46d97077db8bc910b652edb305961957</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2022-04-30 20:11:30</sys_updated_on>
    </sys_script_include>
</record_update>
